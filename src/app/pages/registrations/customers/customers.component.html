<div
  class="container bg-white rounded-[15px] border border-[#E6E9EE] shadow-[0_6px_18px_rgba(17,24,39,0.06)] text-[#111827] text-[11px] leading-[15px] font-medium"
>
  <p-toast />
  <p-confirmdialog />

  <div class="header">
    <h1 class="title text-[14px] leading-[17px] font-semibold text-[#111827]">Cadastro Clientes</h1>
  </div>

  <form
    [formGroup]="SearchForm"
    autocomplete="off"
    class="form flex-col md:flex-row md:items-center md:justify-between gap-3"
  >
    <div class="flex items-center gap-3">
      <p-select
        name="filtro"
        [options]="filtros"
        optionLabel="name"
        placeholder="Selecione o filtro"
        [editable]="true"
        [showClear]="true"
        [checkmark]="true"
        formControlName="filtros"
        styleClass="w-full md:w-[280px] h-9 text-[11px]"
      />

      <div class="flex items-center gap-2 w-full">
        <input
          class="w-full md:w-[280px] h-9 px-3 rounded-[8px] border border-[#10B981] placeholder:text-[#6B7280] text-[11px] leading-[15px] text-[#111827] focus:border-[#10B981] focus:ring-1 focus:ring-[#10B981]"
          name="content"
          formControlName="content"
          autocomplete="off"
          placeholder="Digite o termo de busca"
        />

        <label class="sr-only" for="content">Digite o valor do filtro</label>
        <p-button
          label="Listar"
          icon="pi pi-list"
          class="h-9 px-3 rounded-[6px] text-white leading-[15px] font-medium shadow-[0_6px_18px_rgba(17,24,39,0.06)] transition-colors inline-flex items-center justify-center gap-2 border border-[#10B981]"
          aria-label="Listar"
          (click)="onListClick()"
          [disabled]="SearchForm.invalid || loading"
        ></p-button>
      </div>
    </div>

    <div class="footer mt-2 flex justify-end">
      <button
        type="button"
        pButton
        form="ClientForm"
        label="Adicionar"
        (click)="addItem()"
        icon="pi pi-plus"
        class="h-8 px-3 rounded-[6px] text-white text-[11px] leading-[15px] font-medium shadow-[0_6px_18px_rgba(17,24,39,0.06)] transition-colors inline-flex items-center justify-center gap-2"
        aria-label="Adicionar"
      ></button>
    </div>
  </form>

  <p-table
    class="w-full text-[11px] leading-[15px] text-[#111827]"
    [paginator]="true"
    [value]="clients.data"
    [rows]="10"
    [sortField]="'nome'"
    [sortOrder]="1"
    [totalRecords]="clients.total"
    selectionMode="single"
    [lazy]="true"
    [(selection)]="selectedRow"
    (onLazyLoad)="loadItens($event)"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} até {last} de {totalRecords}"
    [rowsPerPageOptions]="[5, 10, 20, 30, 40, 50]"
    dataKey="id"
    [rowHover]="true"
    [loading]="loading"
  >
    <ng-template pTemplate="header">
      <tr>
        <th
          pSortableColumn="id"
          class="w-[56px] bg-[#FFF7ED] text-[#111827] font-medium h-10 px-3 border-b border-[#E6E9EE]"
        >
          <div class="flex items-center gap-1">
            <span>ID</span>
            <p-sortIcon field="id"></p-sortIcon>
          </div>
        </th>
        <th
          pSortableColumn="cpf"
          class="bg-[#FFF7ED] text-[#111827] font-medium h-10 px-3 border-b border-[#E6E9EE]"
        >
          <div class="flex items-center gap-1">
            <span>CPF</span>
            <p-sortIcon field="cpf"></p-sortIcon>
          </div>
        </th>
        <th
          pSortableColumn="nome"
          class="bg-[#FFF7ED] text-[#111827] font-medium h-10 px-3 border-b border-[#E6E9EE]"
        >
          <div class="flex items-center gap-1">
            <span>Nome</span>
            <p-sortIcon field="nome"></p-sortIcon>
          </div>
        </th>
        <th
          pSortableColumn="telefone"
          class="bg-[#FFF7ED] text-[#111827] font-medium h-10 px-3 border-b border-[#E6E9EE]"
        >
          <div class="flex items-center gap-1">
            <span>Telefone</span>
            <p-sortIcon field="telefone"></p-sortIcon>
          </div>
        </th>
        <th class="bg-[#FFF7ED] text-[#111827] font-medium h-10 px-3 border-b border-[#E6E9EE]">
          Ações
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr class="h-10 bg-[#FFF8E5] hover:bg-[#FFFAF2] cursor-pointer">
        <td class="px-3 text-[11px] leading-[15px] text-[#111827]">{{ item.id }}</td>
        <td class="px-3 text-[11px] leading-[15px] text-[#111827]">{{ formatCpf(item.cpf) }}</td>
        <td class="px-3 text-[11px] leading-[15px] text-[#111827]">{{ item.nome }}</td>
        <td class="px-3 text-[11px] leading-[15px] text-[#111827]">
          {{ formatPhone(item.telefone) }}
        </td>
        <td class="px-2">
          <p-button
            icon="pi pi-pencil"
            class="inline-flex items-center justify-center w-8 h-8 rounded-[6px] text-[#EF4444] text-[9px] border border-[#EF4444] bg-transparent hover:bg-[#FFF1F2] shadow-[0_4px_10px_rgba(0,0,0,0.06)]"
            aria-label="Editar"
            (click)="editItem(item)"
          ></p-button>
          <p-button
            icon="pi pi-trash"
            class="inline-flex items-center justify-center w-8 h-8 rounded-[6px] text-[#EF4444] text-[9px] border border-[#EF4444] bg-transparent hover:bg-[#FFF1F2] shadow-[0_4px_10px_rgba(0,0,0,0.06)] ml-2"
            aria-label="Excluir"
            (click)="messageConfirmDelete(item)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog
    [header]="ClientForm.controls['id'].value === 0 ? 'Adicionar Cliente' : 'Editar Cliente'"
    [(visible)]="exibirDialogo"
    [modal]="true"
    [style]="{ width: '25rem' }"
  >
    <p-message *ngIf="error" severity="error" class="!mt-0 !mb-2" [text]="error"></p-message>
    <form [formGroup]="ClientForm" autocomplete="off" class="space-y-3">
      <div class="flex flex-col gap-1">
        <label for="nome" class="text-[#111827] text-[11px] font-small">Nome</label>
        <input
          pInputText
          id="nome"
          autocomplete="off"
          placeholder="Digite o nome do cliente"
          formControlName="nome"
          class="w-full h-9 px-3 rounded-[8px] text-[11px] leading-[15px] border transition-shadow focus:outline-none placeholder:text-[#10B981] placeholder:text-[11px]"
          [ngClass]="{
            'border-[#EF4444] focus:border-[#EF4444] ring-2 ring-[#FCA5A5]':
              ClientForm.controls['nome'].invalid && ClientForm.controls['nome'].touched,
            'border-[#10B981] focus:border-[#10B981] ring-2 ring-[#A7F3D0]':
              ClientForm.controls['nome'].valid && ClientForm.controls['nome'].touched,
            'border-[#E6E9EE] focus:border-[#F79E0B] focus:ring-2 focus:ring-[#F79E0B]':
              !ClientForm.controls['nome'].touched
          }"
        />
      </div>
      <p-message
        *ngIf="
          ClientForm.controls['nome'].hasError('required') && ClientForm.controls['nome'].touched
        "
        severity="error"
        variant="simple"
        size="small"
        styleClass="mt-1"
        aria-placeholder="Digite o nome do cliente"
        >Nome é obrigatório.
      </p-message>

      <div class="flex flex-col gap-1">
        <label for="cpf" class="text-[#374151] text-[11px] font-medium">CPF</label>
        <input
          pInputText
          id="cpf"
          autocomplete="off"
          formControlName="cpf"
          mask="000.000.000-00"
          [dropSpecialCharacters]="true"
          placeholder="Digite o CPF do cliente"
          class="w-full h-9 px-3 rounded-[8px] text-[11px] leading-[15px] text-[#111827] border transition-shadow focus:outline-none placeholder:text-[#10B981] placeholder:text-[12px]"
          [ngClass]="{
            'border-[#EF4444] focus:border-[#EF4444] ring-2 ring-[#FCA5A5]':
              ClientForm.controls['cpf'].invalid && ClientForm.controls['cpf'].touched,
            'border-[#10B981] focus:border-[#10B981] ring-2 ring-[#A7F3D0]':
              ClientForm.controls['cpf'].valid && ClientForm.controls['cpf'].touched,
            'border-[#E6E9EE] focus:border-[#F79E0B] focus:ring-2 focus:ring-[#F79E0B]':
              !ClientForm.controls['cpf'].touched
          }"
        />
      </div>
      <p-message
        *ngIf="
          ClientForm.controls['cpf'].touched &&
          (ClientForm.controls['cpf'].hasError('required') ||
            ClientForm.controls['cpf'].hasError('cpfInvalid') ||
            ClientForm.controls['cpf'].hasError('cpfTaken'))
        "
        severity="error"
        variant="simple"
        size="small"
        styleClass="mt-1"
        [text]="
          ClientForm.controls['cpf'].hasError('required')
            ? 'CPF é obrigatório'
            : ClientForm.controls['cpf'].hasError('cpfInvalid')
            ? 'CPF inválido'
            : 'CPF já cadastrado'
        "
      />

      <div class="flex flex-col gap-1">
        <label for="telefone" class="text-[#374151] text-[11px] font-medium">Telefone</label>
        <input
          pInputText
          id="telefone"
          autocomplete="off"
          formControlName="telefone"
          mask="(00) 00000-0000"
          [dropSpecialCharacters]="true"
          placeholder="Digite o telefone do cliente"
          class="w-full h-9 px-3 rounded-[8px] text-[11px] leading-[15px] text-[#111827] border transition-shadow focus:outline-none placeholder:text-[#10B981] placeholder:text-[11px]"
          [ngClass]="{
            'border-[#EF4444] focus:border-[#EF4444] ring-2 ring-[#FCA5A5]':
              ClientForm.controls['telefone'].invalid && ClientForm.controls['telefone'].touched,
            'border-[#10B981] focus:border-[#10B981] ring-2 ring-[#A7F3D0]':
              ClientForm.controls['telefone'].valid && ClientForm.controls['telefone'].touched,
            'border-[#E6E9EE] focus:border-[#F79E0B] focus:ring-2 focus:ring-[#F79E0B]':
              !ClientForm.controls['telefone'].touched
          }"
        />
      </div>
      <p-message
        *ngIf="
          ClientForm.controls['telefone'].touched &&
          (ClientForm.controls['telefone'].hasError('required') ||
            ClientForm.controls['telefone'].hasError('phoneInvalid'))
        "
        severity="error"
        variant="simple"
        size="small"
        styleClass="mt-1"
        [text]="
          ClientForm.controls['telefone'].hasError('required')
            ? 'É necessário um número de telefone.'
            : 'Telefone inválido'
        "
      />

      <div class="flex justify-end gap-2 mt-3">
        <ng-container>
          <p-button label="Cancelar" (click)="exibirDialogo = false" />
          <p-button label="Salvar" (click)="saveItem()" [disabled]="ClientForm.invalid || saving" />
        </ng-container>
      </div>
    </form>
  </p-dialog>
</div>
